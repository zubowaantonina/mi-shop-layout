(()=>{"use strict";const t=t=>{const e=document.createElement("div");e.classList.add("modal-backdrop"),e.classList.add("fade"),document.body.append(e),t.classList.add("d-block"),setTimeout((()=>{e.classList.add("show"),t.classList.add("show")}),100)},e=t=>{const e=document.querySelector(".modal-backdrop");t.classList.remove("show"),e&&e.classList.remove("show"),setTimeout((()=>{t.classList.remove("d-block"),e&&e.remove()}),500)},n="http://localhost:3001",o=t=>fetch(n+t).then((t=>{if(!t.ok)throw new Error;return t.json()})),c=(t,e)=>fetch(n+t,{method:"PATCH",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((t=>{if(!t.ok)throw new Error;return t.json()}));(()=>{const n=document.getElementById("open-auth-btn"),c=document.getElementById("open-cart-btn"),a=document.getElementById("logout-btn"),s=document.getElementById("auth-modal"),r=s.querySelectorAll(".close-btn"),l=s.querySelector(".login-btn"),d=()=>{n.classList.add("d-none"),c.classList.remove("d-none"),a.classList.remove("d-none"),e(s)};n.addEventListener("click",(()=>{t(s)})),r.forEach((t=>{t.addEventListener("click",(()=>{e(s)}))})),l.addEventListener("click",(()=>{const t=s.querySelector("#login-control"),e=s.querySelector("#password-control"),n=t.value,c=e.value;o("/profile").then((t=>{console.log(t),t.login&&t.login===n&&t.password&&t.password===c?(console.log("Успех"),d(),localStorage.setItem("auth",JSON.stringify(t))):console.log("Неудача")}))})),a.addEventListener("click",(()=>{localStorage.removeItem("auth"),n.classList.remove("d-none"),c.classList.add("d-none"),a.classList.add("d-none")})),(()=>{const t=JSON.parse(localStorage.getItem("auth"));t&&o("/profile").then((e=>{console.log(e),e.login&&e.login===t.login&&e.password&&e.password===t.password?(console.log("Успех"),d()):(alert("Hello\nHow are you?"),console.log("da"))}))})()})(),(()=>{const t=document.getElementById("categories-container"),e=document.querySelector(".catalog-search"),n=e=>{t.innerHTML="",e.forEach((e=>{t.insertAdjacentHTML("beforeend",`\n                <div class="col col-12 col-md-6 col-lg-4 mb-3">\n                    <a href="/catalog.html?id=${e.id}" class="card-link">\n                        <div class="card">\n                            <img src="${e.preview}" class="card-img-top" alt="phones">\n                            <div class="card-body">\n                                <h5 class="card-title">${e.name}</h5>\n                            </div>\n                        </div>\n                    </a>\n                </div>\n    `)}))};e.addEventListener("input",(t=>{console.log(t.target.value),o(`/categories?q=${t.target.value}`).then((t=>{n(t)})).catch((t=>{console.error("Произошла ошибка!")}))})),o("/categories").then((t=>{n(t)})).catch((t=>{console.error("Произошла ошибка!")}))})(),(()=>{const a=document.getElementById("cart-container"),s=document.getElementById("cart-modal"),r=s.querySelectorAll(".close-btn"),l=document.getElementById("open-cart-btn"),d=document.getElementById("cart-totlal-price"),i=()=>{o("/cart").then((t=>{(t=>{a.innerHTML="",t.forEach((t=>{a.insertAdjacentHTML("beforeend",`\n                <div class="row border-bottom pb-3 pt-3">\n                    <div class="col col-12 col-md-6 mb-3 mb-md-0 fs-4">\n                    ${t.name}\n                    </div>\n                    <div\n                        class="col col-12 col-md-6 fs-4 d-flex align-items-center justify-content-end flex-wrap">\n                        <h4 class="me-3 d-flex align-itemns-center">${t.price} ₽</h4>\n                        <button type="button" class="btn btn-outline-dark btn-sm cart-item-controls"\n                            id="control-dec"  data-id='${t.id}' data-name="${t.name}" data-price="${t.price}" data-count="${t.count}">\n                            -\n                        </button>\n                        <h6 class="cart-item-count me-3 ms-3" >${t.count}</h6>\n                        <button type="button" class="btn btn-outline-dark btn-sm cart-item-controls"\n                            id="control-inc" data-id='${t.id}' data-name="${t.name}" data-price="${t.price}" data-count="${t.count}">\n                            +\n                        </button>\n                    </div>\n                </div>  \n                `)}))})(t),m(t)})).catch((t=>{console.error("Произошла ошибка!")}))},m=t=>{let e=0;t.forEach((t=>{e+=Number(t.price)*Number(t.count)})),d.textContent=e+" ₽"};l.addEventListener("click",(()=>{i(),t(s)})),r.forEach((t=>{t.addEventListener("click",(()=>{e(s)}))})),a.addEventListener("click",(t=>{if(t.target.closest("button"))if(t.target.id&&"control-inc"===t.target.id){console.log("plus");const e=t.target.dataset.id,n=(t.target.dataset.name,Number(t.target.dataset.count));t.target.dataset.price,c(`/cart/${e}`,{count:n+1}).then((()=>{i()}))}else if(t.target.id&&"control-dec"===t.target.id){console.log("minus");const o=t.target.dataset.id,a=(t.target.dataset.name,Number(t.target.dataset.count));t.target.dataset.price,a>1?c(`/cart/${o}`,{count:a-1}).then((()=>{i()})):(e=`/cart/${o}`,fetch(n+e,{method:"DELETE"}).then((t=>{if(!t.ok)throw new Error;return t.json()}))).then((()=>{i()}))}var e}))})()})();