(()=>{"use strict";const e=e=>{const t=document.createElement("div");t.classList.add("modal-backdrop"),t.classList.add("fade"),document.body.append(t),e.classList.add("d-block"),setTimeout((()=>{t.classList.add("show"),e.classList.add("show")}),100)},t=e=>{const t=document.querySelector(".modal-backdrop");e.classList.remove("show"),t&&t.classList.remove("show"),setTimeout((()=>{e.classList.remove("d-block"),t&&t.remove()}),500)},n="http://localhost:3001",o=e=>fetch(n+e).then((e=>{if(!e.ok)throw new Error;return e.json()})),c=()=>{const c=document.getElementById("cart-container"),s=document.getElementById("cart-modal"),a=s.querySelectorAll(".close-btn"),l=document.querySelector("open-cart-btn"),d=()=>{o("/cart").then((e=>{(e=>{e.forEach((e=>{c.insertAdjacentHTML("beforeend",`\n        <div class="row border-bottom pb-3 pt-3">\n            <div class="col col-12 col-md-6 mb-3 mb-md-0 fs-4">\n            ${e.name}\n            </div>\n            <div\n                class="col col-12 col-md-6 fs-4 d-flex align-items-center justify-content-end flex-wrap">\n                <h4 class="me-3 d-flex align-itemns-center">${e.price} ₽</h4>\n                <button type="button" class="btn btn-outline-dark btn-sm cart-item-controls"\n                    id="control-dec">\n                    -\n                </button>\n                <h6 class="cart-item-count me-3 ms-3" >${e.count}</h6>\n                <button type="button" class="btn btn-outline-dark btn-sm cart-item-controls"\n                    id="control-inc" data-id='${e.id}' data-name="${e.name}" data-price="${e.price}" data-count="${e.count}">\n                    +\n                </button>\n            </div>\n        </div>  \n        `)}))})(e)})).catch((e=>{console.error("Произошла ошибка!")}))};l.addEventListener("click",(()=>{d(),e(s)})),a.forEach((e=>{e.addEventListener("click",(()=>{t(s)}))})),c.addEventListener("click",(e=>{if(e.target.closest("button"))if(e.target.id&&"control-inc"===e.target.id){console.log("plus");const c=e.target.dataset.id;(t=`/cart/${c}`,o={id:c,name:e.target.dataset.name,count:Number(e.target.dataset.count)+1,price:e.target.dataset.price},fetch(n+t,{method:"PUT",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}}).then((e=>{if(!e.ok)throw new Error;return e.json()}))).then((()=>{d()}))}else e.target.id&&"control-dec"===e.target.id&&console.log("minus");var t,o}))};(()=>{const n=document.getElementById("open-auth-btn"),s=document.getElementById("open-cart-btn"),a=document.getElementById("logout-btn"),l=document.getElementById("auth-modal"),d=document.getElementById("cart-modal"),r=l.querySelectorAll(".close-btn"),i=l.querySelector(".login-btn"),m=()=>{n.classList.add("d-none"),s.classList.remove("d-none"),a.classList.remove("d-none"),t(l)};n.addEventListener("click",(()=>{e(l)})),r.forEach((e=>{e.addEventListener("click",(()=>{t(l)}))})),i.addEventListener("click",(()=>{const e=l.querySelector("#login-control"),t=l.querySelector("#password-control"),n=e.value,c=t.value;o("/profile").then((e=>{console.log(e),e.login&&e.login===n&&e.password&&e.password===c?(console.log("Успех"),m(),localStorage.setItem("auth",JSON.stringify(e))):console.log("Неудача")}))})),a.addEventListener("click",(()=>{localStorage.removeItem("auth"),n.classList.remove("d-none"),s.classList.add("d-none"),a.classList.add("d-none")})),s.addEventListener("click",(()=>{e(d),c()})),(()=>{const e=JSON.parse(localStorage.getItem("auth"));e&&o("/profile").then((t=>{console.log(t),t.login&&t.login===e.login&&t.password&&t.password===e.password?(console.log("Успех"),m()):console.log("Неудача")}))})()})(),(()=>{const e=document.getElementById("categories-container");o("/categories").then((t=>{(t=>{t.forEach((t=>{e.insertAdjacentHTML("beforeend",`\n                <div class="col col-12 col-md-6 col-lg-4 mb-3">\n                    <a href="/catalog.html?id=${t.id}" class="card-link">\n                        <div class="card">\n                            <img src="${t.preview}" class="card-img-top" alt="phones">\n                            <div class="card-body">\n                                <h5 class="card-title">${t.name}</h5>\n                            </div>\n                        </div>\n                    </a>\n                </div>\n    `)}))})(t)})).catch((e=>{console.error("Произошла ошибка!")}))})(),c()})();