(()=>{"use strict";const e="http://localhost:3001",t=t=>fetch(e+t).then((e=>{if(!e.ok)throw new Error;return e.json()})),n=(t,n)=>fetch(e+t,{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then((e=>{if(!e.ok)throw new Error;return e.json()})),a=t=>fetch(e+t,{method:"DELETE"}).then((e=>{if(!e.ok)throw new Error;return e.json()}));(()=>{const e=document.getElementById("category-name"),d=document.getElementById("category-image"),r=document.getElementById("category-add-btn"),o=document.getElementById("category-container"),c=document.getElementById("product-category"),i={name:"",preview:""},u=()=>{""===e.value||""===d.value?r.disabled=!0:r.disabled=!1},l=()=>{t("/categories").then((e=>{(e=>{o.innerHTML="",e.forEach(((e,t)=>{o.insertAdjacentHTML("beforeend",`\n            <tr>\n                <th scope="row">${t+1}</th>\n                    <td>${e.name}</td>\n                    <td class="text-end">\n                        <button type="button" class="btn btn-outline-danger btn-sm" data-category="${e.id}">\n                            удалить\n                        </button>\n                    </td>\n            </tr>\n            `),c.insertAdjacentHTML("beforeend",`\n            <option value="${e.id}">${e.name}</option>\n            `)}))})(e)}))};e.addEventListener("input",(()=>{i.name=e.value,u()})),d.addEventListener("input",(()=>{const e=d.files[0];if("image/png"===e.type||"image/jpeg"===e.type||"image/jpg"===e.type){const t=new FileReader;t.onload=()=>{i.preview=t.result},t.onerror=()=>{i="",d.value=""},t.readAsDataURL(e)}else d.value="";u()})),r.addEventListener("click",(()=>{n("/categories",i).then((()=>{e.value="",d.value="",l()}))})),o.addEventListener("click",(e=>{if("BUTTON"===e.target.tagName){const t=e.target.dataset.category;a(`/categories/${t}`).then((e=>{l()}))}})),l(),u()})(),(()=>{const e=document.getElementById("product-title"),d=document.getElementById("product-price"),r=document.getElementById("product-name"),o=document.getElementById("product-image"),c=document.getElementById("product-add-btn"),i=document.getElementById("product-table"),u=document.getElementById("product-category"),l={title:"",price:0,name:"",preview:"",category:0},s=e=>{i.innerHTML="",e.forEach(((e,t)=>{i.insertAdjacentHTML("beforeend",`\n            <tr>\n            <th scope="row">${t+1}</th>\n            <td>${e.title}</td>\n            <td>${e.name}</td>\n            <td>${e.price} Р</td>\n            <td class="text-end">\n                <button type="button" class="btn btn-outline-danger btn-sm" data-product="${e.id}">\n                    удалить\n                </button>\n            </td>\n        </tr>\n           \n            `)}))},g=()=>{""===r.value||""===o.value||""===e.value||0===Number(d.value)||"default"===u.value?c.disabled=!0:c.disabled=!1},p=()=>{t("/products").then((e=>{s(e)}))};u.addEventListener("change",(()=>{l.category=u.value;const e="default"!==u.value?`/products?category=${u.value}`:"/products";t(e).then((e=>{s(e)})),g()})),r.addEventListener("input",(()=>{l.name=r.value,g()})),e.addEventListener("input",(()=>{l.title=e.value,g()})),d.addEventListener("input",(()=>{l.price=Number(d.value),g()})),o.addEventListener("input",(()=>{const e=o.files[0];if("image/png"===e.type||"image/jpeg"===e.type||"image/jpg"===e.type){const t=new FileReader;t.onload=()=>{l.preview=t.result},t.onerror=()=>{l="",o.value=""},t.readAsDataURL(e)}else o.value="";g()})),c.addEventListener("click",(()=>{console.log(l),n("/products",l).then((()=>{r.value="",o.value="",e.value="",d.value="",p()}))})),i.addEventListener("click",(e=>{if("BUTTON"===e.target.tagName){const t=e.target.dataset.product;a(`/products/${t}`).then((e=>{p()}))}})),p(),g()})()})();